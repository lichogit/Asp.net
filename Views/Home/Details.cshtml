@model SneakerShop.Models.Product
@{ ViewData["Title"] = Model.Name; }

<div class="container mt-5 pt-4">
    <div class="row g-5">
        <div class="col-md-7">
            <div class="bg-light p-4 text-center h-100 d-flex align-items-center justify-content-center">
                <img src="@Model.ImageUrl" alt="@Model.Name" class="img-fluid shadow-sm" style="max-height: 500px; object-fit: cover;">
            </div>
        </div>

        <div class="col-md-5">
            <h1 class="fw-bolder text-uppercase mb-2">@Model.Name</h1>
            <h3 class="fw-bold mb-4">$@Model.Price.ToString("0.00")</h3>
            <p class="text-muted mb-5">@Model.Description</p>

            <form asp-controller="Cart" asp-action="AddToCart" method="post">
                <input type="hidden" name="id" value="@Model.Id" />

                <div class="d-flex justify-content-between align-items-end mb-3">
                    <label class="form-label text-uppercase small fw-bold text-muted mb-0">Select Size</label>
                    <div class="btn-group" role="group" aria-label="Size Measurements">
                        <input type="radio" class="btn-check" name="measurement" id="btnUS" value="US" checked onchange="updateSizes()">
                        <label class="btn btn-outline-dark btn-sm rounded-0" for="btnUS">US</label>

                        <input type="radio" class="btn-check" name="measurement" id="btnUK" value="UK" onchange="updateSizes()">
                        <label class="btn btn-outline-dark btn-sm rounded-0" for="btnUK">UK</label>

                        <input type="radio" class="btn-check" name="measurement" id="btnEU" value="EU" onchange="updateSizes()">
                        <label class="btn btn-outline-dark btn-sm rounded-0" for="btnEU">EU</label>

                        <input type="radio" class="btn-check" name="measurement" id="btnCM" value="CM" onchange="updateSizes()">
                        <label class="btn btn-outline-dark btn-sm rounded-0" for="btnCM">CM</label>
                    </div>
                </div>

                <select class="form-select form-select-lg rounded-0 mb-4" name="size" id="sizeSelect" required>
                    </select>

                <button type="submit" class="btn btn-dark btn-lg w-100 rounded-0 text-uppercase fw-bold py-3">Add to Cart &rarr;</button>
            </form>
        </div>
    </div>
</div>

@section Scripts {
<script>
    // Shoe size conversion chart
    const sizeData = [
        { us: "7", uk: "6", eu: "40", cm: "25" },
        { us: "7.5", uk: "6.5", eu: "40.5", cm: "25.5" },
        { us: "8", uk: "7", eu: "41", cm: "26" },
        { us: "8.5", uk: "7.5", eu: "42", cm: "26.5" },
        { us: "9", uk: "8", eu: "42.5", cm: "27" },
        { us: "9.5", uk: "8.5", eu: "43", cm: "27.5" },
        { us: "10", uk: "9", eu: "44", cm: "28" },
        { us: "10.5", uk: "9.5", eu: "44.5", cm: "28.5" },
        { us: "11", uk: "10", eu: "45", cm: "29" },
        { us: "11.5", uk: "10.5", eu: "45.5", cm: "29.5" },
        { us: "12", uk: "11", eu: "46", cm: "30" },
        { us: "13", uk: "12", eu: "47.5", cm: "31" }
    ];

    function updateSizes() {
        const select = document.getElementById("sizeSelect");
        const measurement = document.querySelector('input[name="measurement"]:checked').value;
        
        // Remember previous selection if possible to keep it selected
        const prevValue = select.value; 
        
        select.innerHTML = ""; // Clear current options
        
        sizeData.forEach(size => {
            const displayValue = size[measurement.toLowerCase()];
            // The value sent to the server always includes the format (e.g., "US 9" or "EU 42.5")
            const submitValue = `${measurement} ${displayValue}`; 
            
            const option = document.createElement("option");
            option.value = submitValue;
            option.text = displayValue;
            
            if (prevValue && prevValue.includes(size.us)) {
                option.selected = true;
            }
            
            select.appendChild(option);
        });
    }

    // Initialize sizes on page load
    updateSizes();
</script>
}